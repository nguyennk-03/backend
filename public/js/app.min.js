!(function ($) {
    "use strict";

    var Components = function () {};

    // Khởi tạo các plugin
    Components.prototype.initTooltipPlugin = function () {
        $.fn.tooltip && $('[data-bs-toggle="tooltip"]').tooltip();
    };

    Components.prototype.initPopoverPlugin = function () {
        $.fn.popover && $('[data-bs-toggle="popover"]').popover();
    };

    Components.prototype.initToastPlugin = function () {
        $.fn.toast && $('[data-bs-toggle="toast"]').toast();
    };

    Components.prototype.initSlimScrollPlugin = function () {
        if ($.fn.slimScroll) {
            $(".slimscroll").slimScroll({
                height: "auto",
                position: "right",
                size: "8px",
                touchScrollStep: 20,
                color: "#9ea5ab",
            });
        }
    };

    Components.prototype.initFormValidation = function () {
        $(".needs-validation").on("submit", function (event) {
            $(this).addClass("was-validated");
            if ($(this)[0].checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
                return false;
            }
            return true;
        });
    };

    Components.prototype.init = function () {
        this.initTooltipPlugin();
        this.initPopoverPlugin();
        this.initToastPlugin();
        this.initSlimScrollPlugin();
        this.initFormValidation();
    };

    $.Components = new Components();
    $.Components.Constructor = Components;
})(window.jQuery);

(function ($) {
    "use strict";

    var App = function () {
        this.$body = $("body");
        this.$window = $(window);
    };

    App.prototype._resetSidebarScroll = function () {
        $(".slimscroll-menu").slimScroll({
            height: "auto",
            position: "right",
            size: "8px",
            color: "#9ea5ab",
            wheelStep: 5,
            touchScrollStep: 20,
        });
    };

    App.prototype.initMenu = function () {
        var self = this;

        // Toggle menu mobile
        $(".button-menu-mobile").on("click", function (event) {
            event.preventDefault();
            self.$body.toggleClass("sidebar-enable");
            if (self.$window.width() >= 768) {
                self.$body.toggleClass("enlarged");
            } else {
                self.$body.removeClass("enlarged");
            }
            self._resetSidebarScroll();
        });

        // Khởi tạo metisMenu
        $("#side-menu").metisMenu();

        // Đóng sidebar/rightbar khi click bên ngoài
        $(document).on("click", "body", function (e) {
            if (
                $(e.target).closest(".right-bar-toggle, .right-bar").length >
                    0 ||
                $(e.target).closest(".left-side-menu, .side-nav").length > 0 ||
                $(e.target).hasClass("button-menu-mobile") ||
                $(e.target).closest(".button-menu-mobile").length > 0
            ) {
                return;
            }
            $("body")
                .removeClass("right-bar-enabled")
                .removeClass("sidebar-enable");
        });

        // Active menu item dựa trên URL
        $("#side-menu a").each(function () {
            var pageUrl = window.location.href.split(/[?#]/)[0];
            if (this.href === pageUrl) {
                $(this).addClass("active");
                $(this).parent().addClass("active");
                $(this).parent().parent().addClass("in");
                $(this).parent().parent().prev().addClass("active");
                $(this).parent().parent().parent().addClass("active");
            }
        });
    };

    App.prototype.initLayout = function () {
        if (this.$window.width() >= 768 && this.$window.width() <= 1028) {
            this.$body.addClass("enlarged");
        } else if (this.$body.data("keep-enlarged") !== true) {
            this.$body.removeClass("enlarged");
        }
    };

    App.prototype.init = function () {
        this.initLayout();
        this.initMenu();
        $.Components.init();

        this.$window.on(
            "resize",
            function (e) {
                e.preventDefault();
                this.initLayout();
                this._resetSidebarScroll();
            }.bind(this)
        );
    };

    $.App = new App();
    $.App.Constructor = App;
})(window.jQuery);

// Khởi động ứng dụng
$(document).ready(function () {
    window.jQuery.App.init();
});
